-- ============================================
-- مشروع إدارة أدوية الأمراض المزمنة
-- ============================================

-- 1️⃣ جدول الأمراض المزمنة
CREATE TABLE CHRONIC_DISEASES (
    DISEASE_ID NUMBER PRIMARY KEY,
    DISEASE_NAME VARCHAR2(100) NOT NULL
);

-- إدخال بيانات الأمراض المزمنة
INSERT INTO CHRONIC_DISEASES (DISEASE_ID, DISEASE_NAME)
VALUES (1, 'ضغط الدم');

INSERT INTO CHRONIC_DISEASES (DISEASE_ID, DISEASE_NAME)
VALUES (2, 'الكوليسترول والدهون');

COMMIT;

-- 2️⃣ جدول الأدوية
CREATE TABLE MEDICINES (
    MEDICINE_ID NUMBER PRIMARY KEY,
    MEDICINE_NAME VARCHAR2(100) NOT NULL,
    DISEASE_ID NUMBER,
    CONSTRAINT FK_MED_CHRONIC FOREIGN KEY (DISEASE_ID)
        REFERENCES CHRONIC_DISEASES(DISEASE_ID)
);

-- إدخال أدوية ضغط الدم
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (1, 'كونكور (بيسوبرولول)', 1);
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (2, 'أملور (أملوديبين)', 1);
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (3, 'ديوفان (فالسارتان)', 1);

-- إدخال أدوية الكوليسترول
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (4, 'ليبيتور (أتورفاستاتين)', 2);
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (5, 'كريستور (روسوفاستاتين)', 2);
INSERT INTO MEDICINES (MEDICINE_ID, MEDICINE_NAME, DISEASE_ID)
VALUES (6, 'زوكور (سيمفاستاتين)', 2);

COMMIT;

-- 3️⃣ جدول أوقات أخذ الدواء
CREATE TABLE MEDICINE_SCHEDULE (
    SCHEDULE_ID NUMBER PRIMARY KEY,
    MEDICINE_ID NUMBER,
    TAKING_TIME VARCHAR2(200),
    CONSTRAINT FK_SCH_MED FOREIGN KEY (MEDICINE_ID)
        REFERENCES MEDICINES(MEDICINE_ID)
);

-- أوقات أدوية الضغط
INSERT INTO MEDICINE_SCHEDULE VALUES (1, 1, 'صباحاً قبل الإفطار');
INSERT INTO MEDICINE_SCHEDULE VALUES (2, 2, 'موعد ثابت يومياً');
INSERT INTO MEDICINE_SCHEDULE VALUES (3, 3, 'موعد ثابت يومياً');

-- أوقات أدوية الكوليسترول
INSERT INTO MEDICINE_SCHEDULE VALUES (4, 4, 'أي وقت مع الثبات');
INSERT INTO MEDICINE_SCHEDULE VALUES (5, 5, 'موعد ثابت يومياً');
INSERT INTO MEDICINE_SCHEDULE VALUES (6, 6, 'مساءً قبل النوم');

COMMIT;

-- 4️⃣ جدول التنبيهات / الاحترازات
CREATE TABLE MEDICINE_ALERTS (
    ALERT_ID NUMBER PRIMARY KEY,
    MEDICINE_ID NUMBER,
    ALERT_NOTE VARCHAR2(500),
    CONSTRAINT FK_ALERT_MED FOREIGN KEY (MEDICINE_ID)
        REFERENCES MEDICINES(MEDICINE_ID)
);

-- تنبيهات لأدوية الضغط
INSERT INTO MEDICINE_ALERTS VALUES (1, 1, 'يمنع إيقاف الدواء فجأة دون استشارة الطبيب');
INSERT INTO MEDICINE_ALERTS VALUES (2, 2, 'قد يسبب دوار عند أول الاستخدام');

-- تنبيهات أدوية الكوليسترول
INSERT INTO MEDICINE_ALERTS VALUES (3, 6, 'يمنع تناوله مع عصير الجريب فروت');

COMMIT;

-- 5️⃣ استعلام عرض شامل لجميع البيانات
SELECT D.DISEASE_NAME,
       M.MEDICINE_NAME,
       S.TAKING_TIME,
       A.ALERT_NOTE
FROM MEDICINES M
JOIN CHRONIC_DISEASES D ON M.DISEASE_ID = D.DISEASE_ID
LEFT JOIN MEDICINE_SCHEDULE S ON M.MEDICINE_ID = S.MEDICINE_ID
LEFT JOIN MEDICINE_ALERTS A ON M.MEDICINE_ID = A.MEDICINE_ID
ORDER BY D.DISEASE_ID, M.MEDICINE_ID;